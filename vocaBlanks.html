<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>VocabFlash</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/vocaBlanks.js" defer></script>
</head>
<body>

<h1>VocabFlash</h1>
<h2 id="inputCounter">Word: 1 / 10</h2>

<!-- Set Auswahl -->
<label for="setSelect">Choose a set:</label>
<select id="setSelect" onchange="updateVocabSet()">
    <option value="set1">Set 1</option>
    <option value="set2">Set 2</option>
    <!-- Weitere Sets hinzufügen -->
</select>
<button onclick="updateVocabSet()">Bestätigen</button>

<!-- Bereich für die Vokabelabfrage -->
<div id="vocabArea">
    <h3 id="vocabWord"></h3>
    <input type="text" id="userInput" placeholder="Fill in the blank" 
           oninput="toggleCheckButton()" 
           onkeydown="handleKeyDown(event)">
    <button id="submitAnswer" onclick="checkAnswer()" style="display: none;">Check</button>
    <button id="skipButton" onclick="skipToNext()" style="display: none;">Skip</button>
</div>

<!-- Feedback-Element -->
<p id="feedback"></p>

<!-- Skript -->
<script>
let currentSet = [];
let currentIndex = 0;
let wrongAttempts = 0;
let wrongAnswers = [];
let timer;

// Funktion, um die Vokabeln aus dem ausgewählten Set anzuzeigen
function displayVocabWord() {
    const vocabWord = document.getElementById('vocabWord');
    const inputCounter = document.getElementById('inputCounter');
    const submitButton = document.getElementById('submitAnswer');
    const skipButton = document.getElementById('skipButton');

    if (currentSet.length > 0) {
        const vocab = currentSet[currentIndex];
        vocabWord.innerText = vocab.de;
        vocabWord.classList.remove('correct', 'wrong', 'solution');

        inputCounter.innerText = `Word: ${currentIndex + 1} / ${currentSet.length}`;
        submitButton.style.display = "block";
        skipButton.style.display = "none";
    }
}

// Funktion, um das ausgewählte Set zu aktualisieren
function updateVocabSet() {
    const selectedSet = document.getElementById('setSelect').value;
    if (vocabSets[selectedSet]) {
        currentSet = vocabSets[selectedSet];
        currentIndex = 0;
        displayVocabWord();
    } else {
        console.error("Set not found: ", selectedSet);
    }
}

// Funktion für den Skip-Button
function skipToNext() {
    clearTimeout(timer);
    nextWord();
}

// Funktion für den nächsten Wortwechsel
function nextWord() {
    clearTimeout(timer);
    currentIndex++;
    wrongAttempts = 0;

    if (currentIndex < currentSet.length) {
        displayVocabWord();
    } else {
        alert("Exercise completed!");
    }
}

// Funktion, um die Benutzerantwort zu überprüfen
function checkAnswer() {
    const userInput = document.getElementById('userInput').value.toLowerCase();
    const currentWord = currentSet[currentIndex];
    const feedback = document.getElementById('feedback');
    const skipButton = document.getElementById('skipButton');
    const vocabWord = document.getElementById('vocabWord');

    if (userInput === currentWord.ar.toLowerCase()) {
        feedback.innerText = "Correct!";
        feedback.classList.remove('wrong', 'solution');
        feedback.classList.add('correct');
        vocabWord.classList.add('correct');
        skipButton.style.display = "block";
        startTimer();
        wrongAttempts = 0;
    } else {
        handleWrongAnswer(currentWord);
    }

    document.getElementById('userInput').value = '';
    toggleCheckButton();
}

// Funktion zur Behandlung falscher Antworten
function handleWrongAnswer(currentWord) {
    const feedback = document.getElementById('feedback');
    const skipButton = document.getElementById('skipButton');
    const vocabWord = document.getElementById('vocabWord');

    wrongAttempts++;

    if (wrongAttempts === 1) {
        feedback.innerText = "Try again.";
        feedback.classList.remove('correct', 'solution');
        feedback.classList.add('wrong');
        vocabWord.classList.add('wrong');
        skipButton.style.display = "none";
    } else if (wrongAttempts === 2) {
        feedback.innerText = `The correct answer is: ${currentWord.ar}`;
        feedback.classList.remove('correct', 'wrong');
        feedback.classList.add('solution');
        vocabWord.classList.add('solution');
        wrongAnswers.push(currentWord);
        skipButton.style.display = "block";
        startTimer();
    }
}

// Funktion, um den Check-Button basierend auf der Eingabe sichtbar zu machen
function toggleCheckButton() {
    const userInput = document.getElementById('userInput').value;
    const submitButton = document.getElementById('submitAnswer');
    submitButton.style.display = userInput.trim() !== "" && !timer ? "block" : "none";
}

// Funktion, um den Timer zu starten
function startTimer() {
    timer = setTimeout(nextWord, 4000);
}

// Funktion zur Behandlung der Tastenereignisse
function handleKeyDown(event) {
    if (event.key === 'Enter') {
        if (document.getElementById('submitAnswer').style.display !== 'none') {
            checkAnswer();
        } else if (document.getElementById('skipButton').style.display !== 'none') {
            skipToNext();
        }
    }
}

// Initiales Set anzeigen
window.onload = function() {
    updateVocabSet();
};
</script>

<!-- Zurück Links -->
<br><a href="javascript:history.back()">Zurück</a><br>
<a href="index.html">Zurück zur Homepage</a>
<!-- Ende HTML -->
</body>
</html>
