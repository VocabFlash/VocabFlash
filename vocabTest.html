<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabTest</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/vocabSets.js" defer></script>
</head>
<body>

<a href="index.html"><h1>VocabFlash</h1></a>
<br>
<div class="container">
    <h2>VocabTest</h2>
</div>
<br>
<div class="container">
    <label>Choose a set:</label>
    <div id="setSelectContainer">
        <!-- Checkboxen für die Sets werden hier dynamisch eingefügt -->
    </div>
    <button id="confirmSets">Confirm</button>
    <button id="editSets" style="display: none;">Edit</button>
    <br><br>
    <label for="numWords">Enter the number of words for the test:</label>
    <input type="number" id="numWords" min="1" style="width: 50px;">
    <button id="maxButton">MAX</button>
    <button class="confirm-button" id="startTest">Create Test</button>
</div>
<br>
<div class="container">
    <div id="testArea" style="display:none;">
        <form id="testForm">
            <!-- Die Fragen werden hier dynamisch eingefügt -->
        </form>
        <button class="confirm-button" id="submitTest">Check Test</button>
    </div>

    <div id="results" style="display:none;">
        <p id="feedback"></p>
        <button class="confirm-button" id="retryTest">Next</button>
    </div>
</div>

<script>
    // MAX-Button-Funktion
    document.getElementById('maxButton').addEventListener('click', () => {
        const selectedSets = Array.from(document.querySelectorAll('.setCheckbox:checked')).map(cb => cb.value);
    
        // Wörter aus den ausgewählten Sets sammeln
        let allWords = [];
        selectedSets.forEach(setId => {
            allWords = allWords.concat(vocabSets[setId]);
        });
    
        // Setze die Anzahl der Wörter auf die maximale Anzahl der gesammelten Wörter
        document.getElementById('numWords').value = allWords.length;
    });


    document.addEventListener('DOMContentLoaded', () => {
        const setSelectContainer = document.getElementById('setSelectContainer');
        const confirmSetsButton = document.getElementById('confirmSets');
        const editSetsButton = document.getElementById('editSets');
        const startTestButton = document.getElementById('startTest');
        const submitTestButton = document.getElementById('submitTest');
        const testArea = document.getElementById('testArea');
        const testForm = document.getElementById('testForm');
        const results = document.getElementById('results');
        const feedback = document.getElementById('feedback');

        // Checkboxen für jedes Set erstellen
        Object.keys(vocabSets).forEach(setKey => {
            const setName = setKey.replace("set", "Set ");
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = setKey;
            checkbox.value = setKey;
            checkbox.className = 'setCheckbox';

            const label = document.createElement('label');
            label.htmlFor = setKey;
            label.textContent = setName;

            const div = document.createElement('div');
            div.appendChild(checkbox);
            div.appendChild(label);

            setSelectContainer.appendChild(div);
        });

        // Bestätigungs-Button sperrt die Checkboxen
        confirmSetsButton.addEventListener('click', () => {
            const checkboxes = document.querySelectorAll('.setCheckbox');
            checkboxes.forEach(checkbox => {
                checkbox.disabled = true;
            });
            confirmSetsButton.style.display = 'none';
            editSetsButton.style.display = 'inline-block';
        });

        // Bearbeiten-Button entsperrt die Checkboxen
        editSetsButton.addEventListener('click', () => {
            const checkboxes = document.querySelectorAll('.setCheckbox');
            checkboxes.forEach(checkbox => {
                checkbox.disabled = false;
            });
            editSetsButton.style.display = 'none';
            confirmSetsButton.style.display = 'inline-block';
        });

        // Funktion zur Erstellung des Tests
        startTestButton.addEventListener('click', () => {
            testArea.style.display = 'block';
            results.style.display = 'none';
            testForm.innerHTML = ''; // Vorherige Fragen löschen

            const selectedSets = Array.from(document.querySelectorAll('.setCheckbox:checked')).map(cb => cb.value);
            const numWords = parseInt(document.getElementById('numWords').value, 10);

            // Wörter aus den ausgewählten Sets sammeln
            let allWords = [];
            selectedSets.forEach(setId => {
                allWords = allWords.concat(vocabSets[setId]);
            });

            // Zufällige Auswahl der Wörter für den Test
            const selectedWords = [];
            for (let i = 0; i < numWords && allWords.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * allWords.length);
                selectedWords.push(allWords.splice(randomIndex, 1)[0]);
            }

            // Testfragen erstellen
            selectedWords.forEach((word, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');

                const label = document.createElement('label');
                label.textContent = `${index + 1}. ${word.de}`;

                const input = document.createElement('input');
                input.type = 'text';
                input.name = `answer${index}`;

                const feedbackSpan = document.createElement('span');
                feedbackSpan.classList.add('feedback');

                questionDiv.appendChild(label);
                questionDiv.appendChild(input);
                questionDiv.appendChild(feedbackSpan);
                testForm.appendChild(questionDiv);
            });

            // Speichern der ausgewählten Wörter für die Überprüfung
            testForm.dataset.selectedWords = JSON.stringify(selectedWords);
        });

        // Testüberprüfung
        submitTestButton.addEventListener('click', (event) => {
            event.preventDefault();
            const formData = new FormData(testForm);
            const selectedWords = JSON.parse(testForm.dataset.selectedWords);

            // Feedback generieren
            testForm.querySelectorAll('.question').forEach((div, i) => {
                const input = div.querySelector('input');
                const feedback = div.querySelector('.feedback');
                const userAnswer = formData.get(`answer${i}`);
                const correctAnswer = selectedWords[i].ar;

                if (userAnswer && userAnswer.trim() === correctAnswer) {
                    feedback.textContent = "Richtig!";
                    feedback.classList.remove('wrong');
                    feedback.classList.add('correct');
                } else {
                    feedback.textContent = `Falsch! Korrekt: ${correctAnswer}`;
                    feedback.classList.remove('correct');
                    feedback.classList.add('wrong');
                }
            });

            results.style.display = 'block';
        });
    });
</script>
</body>
</html>

