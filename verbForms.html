<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerbForms - VocabFlash</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/verbForms.js" defer></script>
</head>
<body>

<h1>VocabFlash</h1>
<h2 id="inputCounter">Verb: 1 / 10</h2>

<div class="container">
    <h3 id="selectedVerb">Selected Verb: </h3>
    <table id="conjugationTable">
        <thead>
            <tr>
                <th>Pronoun</th>
                <th>Your Answer</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>je</td>
                <td>
                    <input type="text" id="inputJe" onkeydown="handleKeyDown(event)">
                    <span id="feedbackJe" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>tu</td>
                <td>
                    <input type="text" id="inputTu" onkeydown="handleKeyDown(event)">
                    <span id="feedbackTu" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>il/elle</td>
                <td>
                    <input type="text" id="inputIlElle" onkeydown="handleKeyDown(event)">
                    <span id="feedbackIlElle" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>nous</td>
                <td>
                    <input type="text" id="inputNous" onkeydown="handleKeyDown(event)">
                    <span id="feedbackNous" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>vous</td>
                <td>
                    <input type="text" id="inputVous" onkeydown="handleKeyDown(event)">
                    <span id="feedbackVous" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>ils/elles</td>
                <td>
                    <input type="text" id="inputIlsElles" onkeydown="handleKeyDown(event)">
                    <span id="feedbackIlsElles" class="feedback"></span>
                </td>
            </tr>
        </tbody>
    </table>
    
    <button class="confirm-button" id="submitConjugation" onclick="checkAnswers()">Submit Answers</button>
    <button class="confirm-button" id="skipButton" onclick="skipToNext()" style="display: none;">Skip</button>
</div>

<div class="container">
    <label for="setSelect">Choose a verb set:</label>
    <select id="setSelect" onchange="updateVerbSet()">
        <option value="reg1">er-Verbs</option>
        <option value="cerVerbs">cer-Verbs</option>
        <option value="gerVerbs">ger-Verbs</option>
        <option value="doublVerbs">doubl-Verbs</option>
        <option value="irreguler">Irregular Verbs</option>
    </select>

    <label for="tenseSelect">Choose a tense:</label>
    <select id="tenseSelect">
        <option value="present">Present</option>
        <option value="passeCompose">Passé Composé</option>
        <option value="imparfait">Imparfait</option>
        <option value="mixed">Mixed</option>
    </select>
    
    <button class="confirm-button" onclick="loadVerbForConjugation()">Confirm</button>
</div>

<script>
    let currentVerb; // Aktuelles Verb
    let currentIndex = 0; // Index des aktuellen Verbs
    let wrongAnswers = []; // Falsche Antworten speichern
    let secondRound = false; // Überprüfen, ob es die zweite Runde ist
    let currentSet = []; // Aktuelles Set von Verben

    // Funktion für den Skip-Button 
    function skipToNext() {
        nextWord();
    }

    // Funktion für den nächsten Wortwechsel
function nextWord() {
    // Feedback entfernen
    clearFeedback();

    // Wenn es noch nicht die zweite Runde ist und es gibt noch Wörter im Set
    if (!secondRound && currentIndex < currentSet.length - 1) {
        currentIndex++;
        displayVocabWord();
    } 
    // Falls die erste Runde zu Ende ist und es gibt falsche Antworten
    else if (!secondRound && wrongAnswers.length > 0) {
        secondRound = true;
        currentSet = wrongAnswers;
        currentIndex = 0;
        displayVocabWord();
    } 
    // Wenn keine weiteren Wörter da sind
    else {
        showResults(); // Leite zur Ergebnisseite weiter
    }
}


    function clearFeedback() {
        ['Je', 'Tu', 'IlElle', 'Nous', 'Vous', 'IlsElles'].forEach(pronoun => {
            const feedbackElement = document.getElementById(`feedback${pronoun}`);
            feedbackElement.innerHTML = ''; // Entfernt den vorherigen Feedback-Text
            feedbackElement.className = 'feedback'; // Setzt die Klasse zurück
        });
    }

    function displayVocabWord() {
        if (currentSet.length > 0) {
            const vocab = currentSet[currentIndex];
            document.getElementById('selectedVerb').innerText = `Selected Verb: ${vocab.verb}`;

            inputCounter.innerText = `Word: ${currentIndex + 1} / ${currentSet.length}`;
            submitButton.style.display = "block"; // Zeige den Check-Button
            skipButton.style.display = "none"; // Skip-Button nicht sichtbar

            clearInputs(); // Eingabefelder zurücksetzen
        }
    }

    function clearInputs() {
        ['Je', 'Tu', 'IlElle', 'Nous', 'Vous', 'IlsElles'].forEach(pronoun => {
            document.getElementById(`input${pronoun}`).value = ''; // Setzt die Eingabefelder zurück
        });
    }

    function loadVerbForConjugation() {
        const selectedSet = document.getElementById('setSelect').value;
        const selectedTense = document.getElementById('tenseSelect').value;
        const verbs = verbSets[selectedSet];

        if (!verbs) {
            alert("Verb set not found!");
            return;
        }

        const randomIndex = Math.floor(Math.random() * verbs.length);
        currentVerb = verbs[randomIndex];

        document.getElementById('selectedVerb').innerText = `Selected Verb: ${currentVerb.verb}`;

        clearInputs();
        clearFeedback();
    }

function checkAnswers() {
    const selectedTense = document.getElementById('tenseSelect').value;

    const correctAnswers = {
        je: conjugate(currentVerb, selectedTense, 'je').replace('je ', ''),
        tu: conjugate(currentVerb, selectedTense, 'tu').replace('tu ', ''),
        ilElle: conjugate(currentVerb, selectedTense, 'il').replace('il ', ''),
        nous: conjugate(currentVerb, selectedTense, 'nous').replace('nous ', ''),
        vous: conjugate(currentVerb, selectedTense, 'vous').replace('vous ', ''),
        ilsElles: conjugate(currentVerb, selectedTense, 'ils').replace('ils ', '')
    };

    for (const pronoun in correctAnswers) {
        const userAnswer = document.getElementById(`input${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)}`).value.trim();
        const feedbackElement = document.getElementById(`feedback${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)}`);

        if (userAnswer === correctAnswers[pronoun]) {
            feedbackElement.innerHTML = 'Correct!'; 
            feedbackElement.className = 'feedback correct'; 
        } else {
            feedbackElement.innerHTML = `Wrong! Correct answer: ${correctAnswers[pronoun]}`; 
            feedbackElement.className = 'feedback wrong'; 
            wrongAnswers.push(pronoun); 
        }
    }

    // Skip-Button und Submit-Button Logik
    if (wrongAnswers.length === 0) {
        skipButton.style.display = "block"; 
        submitButton.style.display = "none"; 
    } else {
        skipButton.style.display = "none"; 
        submitButton.style.display = "block"; 
    }
}


    // Handle keydown events for navigation
    function handleKeyDown(event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // Verhindere das Standardverhalten des Enter-Keys
            checkAnswers(); // Antworten überprüfen
        } else if (event.key === 'ArrowDown' || event.key === 'PageDown') {
            event.preventDefault(); // Verhindere das Standardverhalten der Pfeiltasten
            const inputs = document.querySelectorAll('input[type="text"]');
            const currentInput = event.target;
            const nextInput = Array.from(inputs).find(input => input === currentInput).nextElementSibling;

            if (nextInput && nextInput.tagName === 'INPUT') {
                nextInput.focus(); // Verschiebe den Fokus zum nächsten Eingabefeld
            }
        }
    }

    document.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
        if (submitButton.style.display !== "none") {
            checkAnswers();
        } else if (skipButton.style.display !== "none") {
            skipToNext();
        }
    }
    
    if (event.key === 'PageDown') {
        const inputs = document.querySelectorAll('input[type="text"]');
        const currentInput = document.activeElement;
        const nextInput = Array.from(inputs).find(input => input === currentInput).nextElementSibling;

        if (nextInput && nextInput.tagName === 'INPUT') {
            nextInput.focus(); // Verschiebe den Fokus zum nächsten Eingabefeld
        }
    }
});

</script>
</body>
</html>
