<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerbForms - VocabFlash</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/verbForms.js" defer></script>
</head>
<body>

<h1>VocabFlash</h1>
<h2 id="inputCounter">Verb: 1 / 10</h2>

<div class="container">
    <h3 id="selectedVerb">Selected Verb: </h3>
    <table id="conjugationTable">
        <thead>
            <tr>
                <th>Pronoun</th>
                <th>Your Answer</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>je</td>
                <td>
                    <input type="text" id="inputJe" onkeydown="handleKeyDown(event)">
                    <span id="feedbackJe" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>tu</td>
                <td>
                    <input type="text" id="inputTu" onkeydown="handleKeyDown(event)">
                    <span id="feedbackTu" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>il/elle</td>
                <td>
                    <input type="text" id="inputIlElle" onkeydown="handleKeyDown(event)">
                    <span id="feedbackIlElle" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>nous</td>
                <td>
                    <input type="text" id="inputNous" onkeydown="handleKeyDown(event)">
                    <span id="feedbackNous" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>vous</td>
                <td>
                    <input type="text" id="inputVous" onkeydown="handleKeyDown(event)">
                    <span id="feedbackVous" class="feedback"></span>
                </td>
            </tr>
            <tr>
                <td>ils/elles</td>
                <td>
                    <input type="text" id="inputIlsElles" onkeydown="handleKeyDown(event)">
                    <span id="feedbackIlsElles" class="feedback"></span>
                </td>
            </tr>
        </tbody>
    </table>
    
    <button class="confirm-button" id="submitConjugation" onclick="checkAnswers()">Submit Answers</button>
    <button class="confirm-button" id="skipButton" onclick="skipToNext()" style="display: none;">Skip</button>
</div>

<div class="container">
    <label for="setSelect">Choose a verb set:</label>
    <select id="setSelect" onchange="updateVerbSet()">
        <option value="reg1">er-Verbs</option>
        <option value="cerVerbs">cer-Verbs</option>
        <option value="gerVerbs">ger-Verbs</option>
        <option value="doublVerbs">doubl-Verbs</option>
        <option value="irreguler">Irregular Verbs</option>
    </select>

    <label for="tenseSelect">Choose a tense:</label>
    <select id="tenseSelect">
        <option value="present">Present</option>
        <option value="passeCompose">Passé Composé</option>
        <option value="imparfait">Imparfait</option>
        <option value="mixed">Mixed</option>
    </select>
    
    <button class="confirm-button" onclick="loadVerbForConjugation()">Confirm</button>
</div>

<script>
    let currentVerb; // Aktuelles Verb
    let currentIndex = 0; // Index des aktuellen Verbs
    let wrongAnswers = []; // Falsche Antworten speichern
    let secondRound = false; // Überprüfen, ob es die zweite Runde ist
    let currentSet = []; // Aktuelles Set von Verben

    // Funktion für den Skip-Button 
    function skipToNext() {
        nextWord();
    }

    // Funktion für den nächsten Wortwechsel
    function nextWord() {
        clearFeedback();

        if (!secondRound && currentIndex < currentSet.length - 1) {
            currentIndex++;
            displayVocabWord();
        } else if (!secondRound && wrongAnswers.length > 0) {
            secondRound = true;
            currentSet = wrongAnswers;
            currentIndex = 0;
            displayVocabWord();
        } else {
            showResults(); // Leite nach den Fragen zur Ergebnisseite weiter
        }
    }

    function clearFeedback() {
        ['Je', 'Tu', 'IlElle', 'Nous', 'Vous', 'IlsElles'].forEach(pronoun => {
            const feedbackElement = document.getElementById(`feedback${pronoun}`);
            feedbackElement.innerHTML = ''; // Entfernt den vorherigen Feedback-Text
            feedbackElement.className = 'feedback'; // Setzt die Klasse zurück
        });
    }

    function displayVocabWord() {
        if (currentSet.length > 0) {
            const vocab = currentSet[currentIndex];
            document.getElementById('selectedVerb').innerText = `Selected Verb: ${vocab.verb}`;

            inputCounter.innerText = `Word: ${currentIndex + 1} / ${currentSet.length}`;
            submitButton.style.display = "block"; // Zeige den Check-Button
            skipButton.style.display = "none"; // Skip-Button nicht sichtbar

            clearInputs(); // Eingabefelder zurücksetzen
        }
    }

    function clearInputs() {
        ['Je', 'Tu', 'IlElle', 'Nous', 'Vous', 'IlsElles'].forEach(pronoun => {
            document.getElementById(`input${pronoun}`).value = ''; // Setzt die Eingabefelder zurück
        });
    }

    function loadVerbForConjugation() {
        const selectedSet = document.getElementById('setSelect').value;
        const selectedTense = document.getElementById('tenseSelect').value;
        const verbs = verbSets[selectedSet];

        if (!verbs) {
            alert("Verb set not found!");
            return;
        }

        const randomIndex = Math.floor(Math.random() * verbs.length);
        currentVerb = verbs[randomIndex];

        document.getElementById('selectedVerb').innerText = `Selected Verb: ${currentVerb.verb}`;

        clearInputs();
        clearFeedback();
    }

    function checkAnswers() {
        const selectedTense = document.getElementById('tenseSelect').value;

        const correctAnswers = {
            je: conjugate(currentVerb, selectedTense, 'je'),
            tu: conjugate(currentVerb, selectedTense, 'tu'),
            ilElle: conjugate(currentVerb, selectedTense, 'il'),
            nous: conjugate(currentVerb, selectedTense, 'nous'),
            vous: conjugate(currentVerb, selectedTense, 'vous'),
            ilsElles: conjugate(currentVerb, selectedTense, 'ils')
        };

        let allCorrect = true;

        for (const pronoun in correctAnswers) {
            const userAnswer = document.getElementById(`input${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)}`).value.trim();
            const feedbackElement = document.getElementById(`feedback${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)}`); // Feedback-Element für das jeweilige Pronomen

            if (userAnswer === correctAnswers[pronoun]) {
                feedbackElement.innerHTML = 'Correct!'; // Füge ein Häkchen hinzu
                feedbackElement.className = 'feedback correct'; // Füge die Klasse für die richtige Antwort hinzu
            } else {
                feedbackElement.innerHTML = `Wrong! Correct answer: ${correctAnswers[pronoun]}`; // Zeige die richtige Antwort an
                feedbackElement.className = 'feedback wrong'; // Füge die Klasse für die falsche Antwort hinzu
                wrongAnswers.push(pronoun); // Füge falsche Antworten zur Liste hinzu
                allCorrect = false; // Markiere, dass nicht alle Antworten korrekt sind
            }
        }

        // Aktiviere den Skip-Button, wenn es falsche Antworten gibt
        if (allCorrect) {
            skipButton.style.display = "block"; // Skip-Button sichtbar machen, wenn alles korrekt ist
            submitButton.style.display = "none"; // Bestätigungs-Button nicht sichtbar
        } else {
            skipButton.style.display = "none"; // Skip-Button nicht sichtbar machen, wenn nicht alles korrekt ist
            submitButton.style.display = "block"; // Bestätigungs-Button sichtbar machen
        }
    }

    // Handle keydown events for navigation
    function handleKeyDown(event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // Verhindere das Standardverhalten des Enter-Keys
            checkAnswers(); // Antworten überprüfen
        } else if (event.key === 'ArrowDown' || event.key === 'PageDown') {
            event.preventDefault(); // Verhindere das Standardverhalten der Pfeiltasten
            const inputs = document.querySelectorAll('input[type="text"]');
            const currentInput = event.target;
            const nextInput = Array.from(inputs).find(input => input === currentInput).nextElementSibling;

            if (nextInput && nextInput.tagName === 'INPUT') {
                nextInput.focus(); // Verschiebe den Fokus zum nächsten Eingabefeld
            }
        }
    }
</script>
</body>
</html>
