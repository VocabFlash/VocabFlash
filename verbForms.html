<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>VocabFlash</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/verbForms.js" defer></script>
</head>
<body>
    <h1>VocabFlash</h1>
    <h2 id="inputCounter">Word: 1 / 10</h2>

    <div class="container">
        <!-- Bereich für die Vokabelabfrage -->
        <div id="vocabArea">
            <h3 id="vocabVerb"></h3>
            <p id="pronoun"></p> <!-- Zeigt das Pronomen an -->
            <input type="text" id="userInput" placeholder="Fill in the blank" 
                   oninput="toggleCheckButton()" 
                   onkeydown="handleKeyDown(event)">
            <div style="text-align: center;">
                <button id="submitAnswer" class="confirm-button" onclick="checkAnswer()" style="display: none;">Check</button>
                <button id="skipButton" class="confirm-button" onclick="skipToNext()" style="display: none;">Skip</button>
            </div> 
            <!-- Feedback-Element -->
            <p id="feedback"></p>
        </div>
    </div>

    <div class="container">
        <!-- Set Auswahl -->
        <label for="setSelect">Choose a set:</label>
        <select id="setSelect" onchange="updateVerbSet()">
            <option value="set1">Set 1</option>
            <option value="set2">Set 2</option>
        </select>

        <label for="tenseSelect">Choose a tense:</label>
        <select id="tenseSelect">
            <option value="present">Present</option>
            <option value="passeCompose">Passé Composé</option>
            <option value="imparfait">Imparfait</option>
        </select>

        <button class="confirm-button" onclick="updateVerbSet()">Confirm</button>
        <br><a href="result.html">Show results</a><br>
        <a href="javascript:history.back()">Go back</a><br>
        <a href="index.html">Go back to homepage</a>
    </div>

    <!-- Skript -->
    <script>
        let currentSet = [];
        let currentIndex = 0;
        let wrongAttempts = 0;
        let wrongAnswers = [];
        let results = [];
        const pronouns = ["je", "tu", "il", "elle", "nous", "vous", "ils", "elles"];

        // Funktion, um Vokabeln und Pronomen anzuzeigen
        function displayVocabWord() {
            const vocabWord = document.getElementById('vocabVerb');
            const pronounElement = document.getElementById('pronoun');
            const inputCounter = document.getElementById('inputCounter');
            const submitButton = document.getElementById('submitAnswer');
            const skipButton = document.getElementById('skipButton');
            const selectedTense = document.getElementById('tenseSelect').value;

            if (currentSet.length > 0) {
                const vocab = currentSet[currentIndex];
                vocabWord.innerText = vocab.de; // Verb anzeigen

                // Zufälliges Pronomen auswählen
                const randomPronoun = pronouns[Math.floor(Math.random() * pronouns.length)];
                pronounElement.innerText = `${randomPronoun} ...`; // Pronomen anzeigen
                
                inputCounter.innerText = `Word: ${currentIndex + 1} / ${currentSet.length}`;
                submitButton.style.display = "block"; // Check-Button anzeigen
                skipButton.style.display = "none"; // Skip-Button ausblenden
            }
        }

        function updateVerbSet() {
            const selectedSet = document.getElementById('setSelect').value;

            // Aktualisiere das aktuelle Set basierend auf der Auswahl
            currentSet = verbSets[selectedSet]; // verbSets muss definiert sein
            currentIndex = 0; // Zurück zum ersten Wort
            displayVocabWord(); // Zeige das erste Wort an
        }

        function checkAnswer() {
            const userInput = document.getElementById('userInput').value.toLowerCase();
            const currentWord = currentSet[currentIndex]; 
            const feedback = document.getElementById('feedback');
            const selectedTense = document.getElementById('tenseSelect').value;
            const pronounElement = document.getElementById('pronoun').innerText.split(" ")[0];

            // Nur der Verbstamm wird geprüft, Pronomen wird ignoriert
            const correctAnswer = currentWord[selectedTense][pronounElement].split(" ")[1]; // Nur das Verb

            if (userInput === correctAnswer.toLowerCase()) {
                feedback.innerText = "Correct!";
                feedback.className = 'feedback correct'; // Stile hinzufügen
                results.push({ word: currentWord.de, pronoun: pronounElement, status: "correct-first" });
                nextWord();
            } else {
                handleWrongAnswer(currentWord, pronounElement, correctAnswer);
            }

            document.getElementById('userInput').value = ''; // Eingabe zurücksetzen
        }

        function handleWrongAnswer(currentWord, pronoun, correctAnswer) {
            const feedback = document.getElementById('feedback');
            const skipButton = document.getElementById('skipButton');

            wrongAttempts++;
            if (wrongAttempts === 2) {
                feedback.innerText = `The correct answer is: ${correctAnswer}`;
                feedback.className = 'feedback solution'; // Stile hinzufügen
                wrongAnswers.push(currentWord);
                results.push({ word: currentWord.de, pronoun: pronoun, status: "second-round" });
                skipButton.style.display = "block";
            }
        }

        // Ergebnisse anzeigen und zu results.html weiterleiten
        function showResults() {
            localStorage.setItem("verbFormResults", JSON.stringify(results));
            window.location.href = "result.html";
        }

        function nextWord() {
            wrongAttempts = 0;
            if (currentIndex < currentSet.length - 1) {
                currentIndex++;
                displayVocabWord();
            } else if (wrongAnswers.length > 0) {
                currentSet = wrongAnswers;
                currentIndex = 0;
                wrongAnswers = [];
                displayVocabWord();
            } else {
                showResults(); // Am Ende der Liste zu den Ergebnissen leiten
            }
        }

        // Funktion zur Erkennung der Enter-Taste für Check und Skip
        function handleKeyDown(event) {
            if (event.key === "Enter") {
                const submitButton = document.getElementById('submitAnswer');
                const skipButton = document.getElementById('skipButton');

                if (submitButton.style.display === "block") {
                    checkAnswer();
                } else if (skipButton.style.display === "block") {
                    skipToNext();
                }
            }
        }

        // Initialisiere das Set bei Seitenaufruf
        window.onload = function() {
            updateVerbSet();
        };

        function skipToNext() {
            nextWord(); // Direkter Sprung zum nächsten Wort
        }
    </script>
</body>
</html>
