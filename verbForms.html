<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerbForms - VocabFlash</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/verbForms.js" defer></script>
</head>
<body>

<h1>VocabFlash</h1>
<h2 id="inputCounter">Verb: 1 / 10</h2>

<div class="container">
    <table id="conjugationTable">
        <h3 id="selectedVerb">Selected Verb: </h3>
        <thead>
            <tr>
                <th>Pronoun</th>
                <th>Your Answer</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>je</td>
                <td><input type="text" id="inputJe"></td>
            </tr>
            <tr>
                <td>tu</td>
                <td><input type="text" id="inputTu"></td>
            </tr>
            <tr>
                <td>il/elle</td>
                <td><input type="text" id="inputIlElle"></td>
            </tr>
            <tr>
                <td>nous</td>
                <td><input type="text" id="inputNous"></td>
            </tr>
            <tr>
                <td>vous</td>
                <td><input type="text" id="inputVous"></td>
            </tr>
            <tr>
                <td>ils/elles</td>
                <td><input type="text" id="inputIlsElles"></td>
            </tr>
        </tbody>
    </table>
    
    <button id="submitConjugation" onclick="checkAnswers()">Submit Answers</button>
    <div id="feedback"></div>
</div>

<div class="container">
    <label for="setSelect">Choose a verb set:</label>
    <select id="setSelect" onchange="updateVerbSet()">
        <option value="reg1">er-Verbs</option>
        <option value="cer">cer-Verbs</option>
        <option value="ger">ger-Verbs</option>
        <option value="doubl">doubl-Verbs</option>
        <option value="irreguler">Irregular Verbs</option>
        <!-- Weitere Sets hinzufügen -->
    </select>

    <label for="tenseSelect">Choose a tense:</label>
    <select id="tenseSelect" onchange="updateVerbSet()">
        <option value="present">Present</option>
        <option value="passe">Passé Composé</option>
        <option value="imparfait">Imparfait</option>
        <option value="mixed">mixed</option>
    </select>
    
    <button class="confirm-button" onclick="updateVerbSet()">Confirm</button>
    
    <!-- Zurück Links -->
    <br><a href="result.html">Show results</a><br>
    <a href="javascript:history.back()">Go back</a><br>
    <a href="index.html">Go back to homepage</a>
</div>

<!-- Skript -->
<script>
let currentSet = [];
let currentIndex = 0;
let wrongAttempts = 0;
let wrongAnswers = [];
let secondRound = false; // Flag für die zweite Runde
let timer;
let results = [];

// Funktion zum Laden des Verbs in die Tabelle
function loadVerbForConjugation() {
    const selectedSet = document.getElementById('setSelect').value;
    const selectedTense = document.getElementById('tenseSelect').value;

    // Überprüfe, ob das ausgewählte Set und die Zeitform existieren
    if (verbSets[selectedSet] && verbSets[selectedSet][selectedTense]) {
        const randomIndex = Math.floor(Math.random() * verbSets[selectedSet][selectedTense].length);
        const verb = verbSets[selectedSet][selectedTense][randomIndex];

        // Setze die Verbbezeichnung in der Tabelle
        const verbName = verb.verb; 
        
        // Zeige das ausgewählte Verb an
        document.getElementById('selectedVerb').innerText = `Selected Verb: ${verbName}`;
        
        // Fülle die Tabelle mit den Pronomen
        for (const pronoun of ['Je', 'Tu', 'IlElle', 'Nous', 'Vous', 'IlsElles']) {
            document.getElementById(`input${pronoun}`).value = ''; // Leere die Eingabefelder
        }

        // Feedback zur aktuellen Verbbezeichnung (optional)
        console.log(`Loaded verb: ${verbName} for conjugation`);
    } else {
        console.error(`Set or tense not found for ${selectedSet}, ${selectedTense}`);
        alert(`Das ausgewählte Set oder die Zeitform wurde nicht gefunden: ${selectedSet}, ${selectedTense}`);
    }
}

// Funktion zur Überprüfung der Antworten
function checkAnswers() {
    // Hier wird das korrekte Verb verwendet, basierend auf dem aktuellen Set und der Zeitform
    const selectedSet = document.getElementById('setSelect').value;
    const selectedTense = document.getElementById('tenseSelect').value;

    console.log(`Checking answers for selected set: ${selectedSet}, tense: ${selectedTense}`);

    if (verbSets[selectedSet] && verbSets[selectedSet][selectedTense]) {
        const verb = verbSets[selectedSet][selectedTense][currentIndex]; // Aktuelles Verb
        const correctAnswers = {
            je: conjugate({ verb: verb.verb, group: verb.group }, selectedTense, "je"), // 'je parle'
            tu: conjugate({ verb: verb.verb, group: verb.group }, selectedTense, "tu"), // 'tu parles'
            ilElle: conjugate({ verb: verb.verb, group: verb.group }, selectedTense, "il"), // 'il/elle parle'
            nous: conjugate({ verb: verb.verb, group: verb.group }, selectedTense, "nous"), // 'nous parlons'
            vous: conjugate({ verb: verb.verb, group: verb.group }, selectedTense, "vous"), // 'vous parlez'
            ilsElles: conjugate({ verb: verb.verb, group: verb.group }, selectedTense, "ils") // 'ils/elles parlent'
        };

        let feedbackMessage = '';

        // Überprüfen der Antworten
        for (const pronoun in correctAnswers) {
            const userInput = document.getElementById(`input${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)}`).value.trim();
            console.log(`User input for ${pronoun}: ${userInput}, Correct answer: ${correctAnswers[pronoun]}`);
            if (userInput === correctAnswers[pronoun]) {
                feedbackMessage += `Correct for ${pronoun}: ${userInput}<br>`;
            } else {
                feedbackMessage += `Incorrect for ${pronoun}: ${userInput}. Correct answer: ${correctAnswers[pronoun]}<br>`;
            }
        }

        // Feedback anzeigen
        document.getElementById('feedback').innerHTML = feedbackMessage;
    } else {
        console.error(`Set or tense not found for ${selectedSet}, ${selectedTense}`);
        alert(`Das ausgewählte Set oder die Zeitform wurde nicht gefunden: ${selectedSet}, ${selectedTense}`);
    }
}

// Funktion, um das ausgewählte Set zu aktualisieren
function updateVerbSet() {
    const selectedSet = document.getElementById('setSelect').value;
    const selectedTense = document.getElementById('tenseSelect').value;

    console.log(`updateVerbSet called: verbForms.html:172:13`);
    console.log(`Updating verb set to: ${selectedSet}, tense: ${selectedTense}`);

    // Überprüfe, ob das ausgewählte Set und die Zeitform existieren
    if (verbSets[selectedSet] && verbSets[selectedSet][selectedTense]) {
        currentSet = verbSets[selectedSet][selectedTense];
        currentIndex = 0;
        wrongAnswers = []; // Reset der falschen Antworten beim Set-Wechsel
        secondRound = false; // Zurücksetzen der zweiten Runde
        
        // Lade das Verb für die Konjugation
        loadVerbForConjugation(); // Füge diese Zeile hinzu
    } else {
        console.error(`Set or tense not found for ${selectedSet}, ${selectedTense}`);
        alert(`Das ausgewählte Set oder die Zeitform wurde nicht gefunden: ${selectedSet}, ${selectedTense}`);
    }
}
</script>

</body>
</html>
