<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ergebnisse</title>
    <link rel="stylesheet" href="css/resultstyle.css">
</head>
<body>
<a href="index.html"><h1>VocabFlash</h1></a>
<div class="container">
    <h2>Results</h2>
</div>
    
<table id="vocabResultsTable">
    <thead id="tableHeader"></thead>
    <tbody id="resultsContainer"></tbody>
</table>

<br>
    
<div class="container">
    <label for="resultDropdown">Choose the result type:</label>
    <select id="resultDropdown" aria-label="Choose the result type" onchange="updateResults()">
        <option value="practise">Practise Flashcards</option>
        <option value="verbForms">Verbs</option>
        <option value="vocaBlanks">Blanks</option>
        <option value="vocaInput">Spelling</option>
    </select>

    <br>
    <button onclick="updateResults()">Select</button>
    <br>
    <a href="index.html">Go back to Homepage</a>
</div>

<script>
// Ergebnisse aus localStorage abrufen und überprüfen
function getFromLocalStorage(key) {
    console.log(`Versuche, Daten für ${key} aus localStorage abzurufen...`);
    const data = localStorage.getItem(key);
    if (!data) {
        console.error(`Keine Daten im localStorage für ${key} gefunden.`);
        return [];
    }
    try {
        console.log(`Daten für ${key} erfolgreich abgerufen.`);
        return JSON.parse(data);
    } catch (e) {
        console.error(`Fehler beim Parsen von ${key}:`, e);
        return [];
    }
}

const resultsContainer = document.getElementById('resultsContainer');
const tableHeader = document.getElementById('tableHeader');
const dropdown = document.getElementById('resultDropdown'); 

function loadResults() {
    console.log('Lade Ergebnisse basierend auf der Dropdown-Auswahl...');
    resultsContainer.innerHTML = ""; // Vorherige Ergebnisse löschen

    const selectedType = dropdown.value; // Aktuelle Auswahl im Dropdown
    console.log(`Aktuell ausgewählter Typ: ${selectedType}`);

    let loadedResults = [];
    let headerHTML = '';

    switch (selectedType) {
        case 'practise':
            loadedResults = getFromLocalStorage("flashcardResults");
            console.log(`Ergebnisse für 'practise' geladen:`, loadedResults);
            headerHTML = `
                <tr>
                    <th>Wort</th>
                    <th>Status</th>
                </tr>
            `;
            break;
        case 'verbForms':
            loadedResults = getFromLocalStorage("verbFormResults");
            console.log(`Ergebnisse für 'verbForms' geladen:`, loadedResults);
            headerHTML = `
                <tr>
                    <th>Verb</th>
                    <th>Pronoun</th>
                    <th>Status</th>
                </tr>
            `;
            break;
        case 'vocaBlanks':
            loadedResults = getFromLocalStorage("vocaBlanksResults");
            console.log(`Ergebnisse für 'vocaBlanks' geladen:`, loadedResults);
            headerHTML = `
                <tr>
                    <th>Wort</th>
                    <th>Status</th>
                </tr>
            `;
            break;
        case 'vocaInput':
            loadedResults = getFromLocalStorage("vocaInputResults");
            console.log(`Ergebnisse für 'vocaInput' geladen:`, loadedResults);
            headerHTML = `
                <tr>
                    <th>Wort</th>
                    <th>Status</th>
                </tr>
            `;
            break;
        default:
            console.error('Unbekannter Typ ausgewählt:', selectedType);
            return; // Keine Ergebnisse laden, wenn der Typ unbekannt ist
    }

    // Wenn keine Ergebnisse geladen wurden
    if (loadedResults.length === 0) {
        console.warn(`Keine Ergebnisse verfügbar für ${selectedType}`);
        resultsContainer.innerHTML = "<tr><td colspan='3'>Keine Ergebnisse verfügbar.</td></tr>";
        return;
    }

    // Header der Tabelle setzen
    tableHeader.innerHTML = headerHTML;
    console.log(`Tabellen-Header gesetzt: ${headerHTML}`);

    // Ergebniszeilen hinzufügen
    loadedResults.forEach(result => {
        const resultRow = createResultRow(result.word, result.pronoun || null, result.status);
        resultsContainer.appendChild(resultRow);
        console.log('Ergebniszeile hinzugefügt:', resultRow);
    });
}

function createResultRow(word, pronoun, status) {
    console.log(`Erstelle Ergebniszeile für: Wort = ${word}, Pronoun = ${pronoun}, Status = ${status}`);
    const resultRow = document.createElement('tr');
    resultRow.classList.add(status); // Klasse für den Status hinzufügen

    const wordCell = document.createElement('td');
    wordCell.innerText = word;
    resultRow.appendChild(wordCell);

    // Nur pronoun hinzufügen, wenn es im Modus ist
    if (pronoun) {
        const pronounCell = document.createElement('td');
        pronounCell.innerText = pronoun;
        resultRow.appendChild(pronounCell);
    }

    const statusCell = document.createElement('td');
    statusCell.innerText = status.replace("-", " ");
    
    // Färbe die Statusanzeige basierend auf dem Status
    if (status === 'correct-first') {
        statusCell.classList.add('correct'); // Klasse für grün
    } else if (status === 'second-round') {
        statusCell.classList.add('wrong'); // Klasse für rot
    }

    resultRow.appendChild(statusCell);
    return resultRow;
}

// Ergebnisse beim Laden der Seite abrufen
window.onload = loadResults;

// Ergebnisse aktualisieren, wenn Dropdown geändert wird
function updateResults() {
    loadResults();
}

</script>
</body>
</html>
