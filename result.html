<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results</title>
    <link rel="stylesheet" href="css/resultstyle.css">
    <style>
        .table-container {
            margin-bottom: 20px; /* Abstand zwischen den Tabellen */
        }
        table {
            width: 55%; 
            border-collapse: collapse; /* Tabellenränder zusammenführen */
            margin: auto; /* Zentriert die Tabelle */
        }
        th, td {
            border: 1px solid #ccc; /* Tabellenrahmen */
            padding: 8px; /* Innenabstand */
            text-align: left; /* Text links ausrichten */
            width: 50%;
        }


        /* Linke Spalte */
        td.left-column {
            font-size: 10px; /* Schriftgröße verkleinern */
        }
        /* Rechte Spalte */
        td.right-column {
            font-size: 16px; /* Schriftgröße vergrößern */
        }
        /* Status-Farben */
        .correct-first {
            color: green;
        }
        .wrong-first {
            color: orange;
        }
        .second-round {
            color: red;
        }
    </style>
</head>
<body>
<a href="index.html"><h1>VocabFlash</h1></a>
    
<div class="container">
    <h2>Results</h2>
</div>
    
<div class="table-container" id="tableContainer">
    <table id="vocabResultsTableRound1">
        <thead id="tableHeaderRound1"></thead>
        <tbody id="resultsContainerRound1"></tbody>
    </table>

    <table id="vocabResultsTableRound2" style="display: none;">
        <thead id="tableHeaderRound2"></thead>
        <tbody id="resultsContainerRound2"></tbody>
    </table>
</div>

<br>

<div class="container">
    <label for="resultDropdown">Choose the result type:</label>
    <select id="resultDropdown" aria-label="Choose the result type" onchange="updateResults()">
        <option value="practise">Practise Flashcards</option>
        <option value="verbForms">Verbs</option>
        <option value="vocaBlanks">Blanks</option>
        <option value="vocaInput">Spelling</option>
    </select>

    <br>
    <button onclick="updateResults()">Select</button>
    <br>
    <a href="index.html">Go back to Homepage</a>
</div>

<script>
function getFromLocalStorage(key) {
    const data = localStorage.getItem(key);
    if (!data) {
        console.log(`No data found for key: ${key}`);
        return [];
    }
    try {
        const parsedData = JSON.parse(data);
        console.log(`Data successfully retrieved for key: ${key}`);
        return parsedData;
    } catch (e) {
        console.error(`Failed to parse data for key: ${key}`, e);
        return [];
    }
}

const resultsContainerRound1 = document.getElementById('resultsContainerRound1');
const resultsContainerRound2 = document.getElementById('resultsContainerRound2');
const tableHeaderRound1 = document.getElementById('tableHeaderRound1');
const tableHeaderRound2 = document.getElementById('tableHeaderRound2');
const dropdown = document.getElementById('resultDropdown');

function loadResults() {
    resultsContainerRound1.innerHTML = ""; // Clear previous results
    resultsContainerRound2.innerHTML = "";

    const selectedType = dropdown.value;
    let loadedResults = getFromLocalStorage(selectedType + "Results");

    if (loadedResults.length === 0) {
        console.log("No results available to display.");
        resultsContainerRound1.innerHTML = "<tr><td colspan='2'>No results available.</td></tr>";
        document.getElementById('vocabResultsTableRound2').style.display = 'none'; // Hide round 2 table if no results
        return;
    }

    let headerHTML = `
        <tr>
            <th>Translation</th>
            <th>Word</th>
        </tr>
    `;

    tableHeaderRound1.innerHTML = headerHTML;
    tableHeaderRound2.innerHTML = headerHTML;

    // Sort results for the first and second rounds
    const round1Results = loadedResults.filter(result => result.status === "correct-first" || result.status === "wrong-first");
    const round2Results = loadedResults.filter(result => result.status === "second-round");

    // Populate round 1 results
    if (round1Results.length > 0) {
        console.log("Populating round 1 results...");
        round1Results.forEach(result => {
            const resultRow = createResultRow(result.de, result.ar, result.status); // Hier die richtigen Felder verwenden
            resultsContainerRound1.appendChild(resultRow);
        });
        document.getElementById('vocabResultsTableRound1').style.display = 'table';
    } else {
        console.log("No round 1 results found.");
        document.getElementById('vocabResultsTableRound1').style.display = 'none';
    }

    // Populate round 2 results
    if (round2Results.length > 0) {
        console.log("Populating round 2 results...");
        round2Results.forEach(result => {
            const resultRow = createResultRow(result.de, result.ar, result.status); // Hier die richtigen Felder verwenden
            resultsContainerRound2.appendChild(resultRow);
        });
        document.getElementById('vocabResultsTableRound2').style.display = 'table';
    } else {
        console.log("No round 2 results found.");
        document.getElementById('vocabResultsTableRound2').style.display = 'none';
    }
} // Hier die schließende Klammer hinzufügen

function createResultRow(word, translation, status) {
    const resultRow = document.createElement('tr');
    
    const wordCell = document.createElement('td');
    wordCell.innerText = word;
    wordCell.classList.add(status); // Add class for status (color)
    resultRow.appendChild(wordCell);

    const translationCell = document.createElement('td');
    translationCell.innerText = translation;
    translationCell.classList.add(status); // Add class for status (color)
    resultRow.appendChild(translationCell);

    return resultRow;
}

window.onload = () => {
    console.log("Loading results page...");
    loadResults();
};

function updateResults() {
    console.log("Results type updated to:", dropdown.value);
    loadResults();
}
</script>
</body>
</html>
